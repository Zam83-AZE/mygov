<!DOCTYPE html>
<html lang="az">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SÄ°MA Login TÉ™sdiqi</title>
    <style>
        :root {
            --primary: #007bff;
            --success: #28a745;
            --warning: #ffc107;
            --dark: #343a40;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #f4f7f6;
            margin: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            color: var(--dark);
        }

        .container {
            background: white;
            padding: 30px;
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            max-width: 420px;
            width: 90%;
            text-align: center;
        }

        .icon-box {
            font-size: 50px;
            margin-bottom: 20px;
        }

        h2 { margin-bottom: 10px; font-size: 24px; }
        p { color: #666; font-size: 15px; line-height: 1.6; }

        .guide-box {
            background-color: #fff9db;
            border-left: 5px solid var(--warning);
            padding: 15px;
            margin: 20px 0;
            text-align: left;
            font-size: 14px;
            border-radius: 4px;
        }

        .btn {
            display: block;
            width: 100%;
            padding: 16px;
            margin-top: 15px;
            border: none;
            border-radius: 12px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
        }

        #loginBtn {
            background-color: var(--primary);
            color: white;
        }

        #dataBtn {
            background-color: var(--success);
            color: white;
            display: none; /* Login baÅŸlayana qÉ™dÉ™r gizli */
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% { transform: scale(1); box-shadow: 0 0 0 0 rgba(40, 167, 69, 0.4); }
            70% { transform: scale(1.02); box-shadow: 0 0 0 10px rgba(40, 167, 69, 0); }
            100% { transform: scale(1); box-shadow: 0 0 0 0 rgba(40, 167, 69, 0); }
        }

        .loading-text { font-size: 13px; color: var(--primary); font-weight: bold; display: none; }
    </style>
</head>
<body>

<div class="container">
    <div class="icon-box">ğŸ›¡ï¸</div>
    <h2>Portal GiriÅŸi</h2>
    <p id="statusText">MÉ™lumatlarÄ±nÄ±zÄ± gÃ¶rmÉ™k Ã¼Ã§Ã¼n SÄ°MA vasitÉ™silÉ™ giriÅŸi tamamlamalÄ±sÄ±nÄ±z.</p>

    <div class="guide-box">
        <strong>TÉ™limat:</strong><br>
        1. "DigÉ™r Ã¼sullar" bÃ¶lmÉ™sini seÃ§in.<br>
        2. "SÄ°MA Ä°mza" ilÉ™ giriÅŸi tamamlayÄ±n.<br>
        3. <b>GiriÅŸ bitdikdÉ™ hÉ™min pÉ™ncÉ™rÉ™ni baÄŸlayÄ±b bura qayÄ±dÄ±n.</b>
    </div>

    <button id="loginBtn" class="btn" onclick="openLogin()">1. GiriÅŸ SÉ™hifÉ™sini AÃ§</button>
    <div id="loadingMsg" class="loading-text">Portalda giriÅŸ gÃ¶zlÉ™nilir...</div>
    
    <button id="dataBtn" class="btn" onclick="redirectToData()">2. GiriÅŸ TamamlandÄ±, Davam Et</button>
</div>

<script>
    let authWindow = null;
    let pollTimer = null;

    function openLogin() {
        // BirbaÅŸa login metodlarÄ±nÄ±n olduÄŸu URL
        const loginUrl = 'https://mygovid.gov.az/auth';
        authWindow = window.open(loginUrl, '_blank');

        // UI YenilÉ™mÉ™
        document.getElementById('loginBtn').innerText = "YenidÉ™n AÃ§";
        document.getElementById('loginBtn').style.backgroundColor = "#6c757d";
        document.getElementById('dataBtn').style.display = "block";
        document.getElementById('loadingMsg').style.display = "block";
        document.getElementById('statusText').innerText = "ZÉ™hmÉ™t olmasa, digÉ™r tabda giriÅŸi tamamlayÄ±n.";

        // Mechanism A: PÉ™ncÉ™rÉ™nin baÄŸlanmasÄ±nÄ± yoxla
        if (pollTimer) clearInterval(pollTimer);
        pollTimer = setInterval(function() {
            if (authWindow && authWindow.closed) {
                clearInterval(pollTimer);
                autoForward();
            }
        }, 1000);
    }

    // Mechanism B: Taba geri qayÄ±dÄ±ÅŸÄ± yoxla (Mobil Ã¼Ã§Ã¼n)
    document.addEventListener("visibilitychange", function() {
        if (!document.hidden && authWindow !== null) {
            // Ä°stifadÉ™Ã§i SÄ°MA-dan sonra bizim sayta qayÄ±tdÄ±sa
            handleReturn();
        }
    });

    function handleReturn() {
        document.getElementById('statusText').innerHTML = "<b style='color:var(--success)'>QayÄ±tdÄ±ÄŸÄ±nÄ±z Ã¼Ã§Ã¼n tÉ™ÅŸÉ™kkÃ¼rlÉ™r!</b> GiriÅŸ tamamlandÄ±sa davam edin.";
        document.getElementById('loadingMsg').style.display = "none";
    }

    function autoForward() {
        // PÉ™ncÉ™rÉ™ baÄŸlandÄ±ÄŸÄ± an avtomatik yÃ¶nlÉ™ndirmÉ™ cÉ™hdi
        alert("GiriÅŸ pÉ™ncÉ™rÉ™si baÄŸlandÄ±. MÉ™lumatlara yÃ¶nlÉ™ndirilirsiniz...");
        redirectToData();
    }

    function redirectToData() {
        // Æsas hÉ™dÉ™f URL
        window.location.href = 'https://my.gov.az/history/consent/companies/104';
    }
</script>

</body>
</html>
